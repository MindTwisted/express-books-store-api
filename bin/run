#!/usr/bin/env node

const fs = require('fs');
const program = require('commander');
const inquirer = require('inquirer');
const NodeRSA = require('node-rsa');
const pd = process.platform === 'win32' ? '\\' : '/';

program.version('0.0.1', '-v, --version');

program
    .command('generate-keys')
    .action(() => {
        inquirer
            .prompt([
                {
                    type: 'confirm',
                    name: 'toGenerateKeys',
                    message: 'This command will generate new security keys. Do you want to continue?',
                    default: false
                }
            ]).then(answers => {
                if (!answers.toGenerateKeys) {
                    console.log('Security keys were not generated.')

                    process.exit(0);
                }

                const key = new NodeRSA({
                    b: 512
                });

                const privateKey = key.exportKey('pkcs8-private');
                const publicKey = key.exportKey('pkcs8-public');

                fs.writeFileSync('private.key', privateKey);
                console.log(`${process.cwd()}${pd}private.key was successfully generated.`);

                fs.writeFileSync('public.key', publicKey);
                console.log(`${process.cwd()}${pd}public.key was successfully generated.`);
            });
    });

program.parse(process.argv);